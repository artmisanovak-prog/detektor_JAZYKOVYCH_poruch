<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Analyz√°tor v√Ωpovƒõd√≠</title>
    <style>
        * { box-sizing: border-box; font-family: sans-serif; }
        body { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; background: #fafafa; }
        h1 { color: #1e3c5c; border-bottom: 2px solid #ccc; padding-bottom: 0.5rem; }
        textarea { width: 100%; height: 200px; padding: 0.75rem; font-size: 1rem; border: 1px solid #aaa; border-radius: 6px; }
        button { padding: 0.75rem 2rem; font-size: 1.2rem; background: #1e3c5c; color: white; border: none; border-radius: 6px; cursor: pointer; margin: 1rem 0; }
        button:hover { background: #143047; }
        .legend { display: flex; flex-wrap: wrap; gap: 1rem; margin: 1rem 0; padding: 1rem; background: #e9eef2; border-radius: 8px; }
        .legend-item { display: flex; align-items: center; gap: 0.5rem; }
        .color-box { width: 24px; height: 24px; border-radius: 4px; }
        .analyzed-text { background: white; border: 1px solid #ccc; padding: 1rem; border-radius: 8px; white-space: pre-wrap; line-height: 1.8; }
        .analyzed-text mark { padding: 2px 0; border-radius: 4px; }
        .stats { margin-top: 2rem; }
        .stats h3 { margin-bottom: 0.5rem; }
        .stats ul { list-style: none; padding: 0; }
        .stats li { padding: 0.5rem; margin-bottom: 0.5rem; background: white; border-left: 6px solid; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .stats li strong { display: inline-block; min-width: 120px; }
        .note { font-size: 0.9rem; color: #555; margin-top: 2rem; border-top: 1px solid #ccc; padding-top: 1rem; }
    </style>
</head>
<body>
    <h1>üîç Analyz√°tor jazykov√Ωch poruch</h1>
    <p>Vlo≈æte text (v√Ωpovƒõƒè, email, p≈ôepis). N√°stroj automaticky najde a barevnƒõ oznaƒç√≠ vybran√© poruchy.</p>

    <textarea id="inputText" placeholder="Sem vlo≈æte text..."></textarea>
    <button onclick="analyze()">Analyzovat</button>

    <div class="legend" id="legend"></div>
    <div id="result" class="analyzed-text"></div>
    <div id="stats" class="stats"></div>
    <div class="note">
        ‚ö†Ô∏è N√°stroj pouze ukazuje, nevyhodnocuje. Ka≈æd√Ω n√°lez je t≈ôeba interpretovat v kontextu p≈ô√≠padu.
        Seznam poruch a ot√°zek najdete v <a href="../poruchy/12-poruch.md" target="_blank">p≈ôehledu poruch</a>.
    </div>

    <script>
        // Definice poruch (jen ty, kter√© um√≠me jednodu≈°e detekovat)
        const PORUCHY = [
            { id: 1, nazev: "Opakov√°n√≠", barva: "#ffcccc", detektor: detekujOpakovani },
            { id: 2, nazev: "P≈ôeskok", barva: "#cce5ff", detektor: null },  // slo≈æit√©, zat√≠m ne
            { id: 3, nazev: "Fixace", barva: "#ffe6b3", detektor: null },
            { id: 4, nazev: "Ztr√°ta souseda", barva: "#d9d9d9", detektor: null },
            { id: 5, nazev: "P≈ôetr≈æen√≠", barva: "#f9c6c6", detektor: detekujPretrzeni },
            { id: 6, nazev: "Posun kontextu", barva: "#d5b3ff", detektor: null },
            { id: 7, nazev: "Z√°mƒõna rol√≠", barva: "#b3e0b3", detektor: null },
            { id: 8, nazev: "Rozpad syntaxe", barva: "#ffb3ba", detektor: null },
            { id: 9, nazev: "Emocion√°ln√≠ zlom", barva: "#ffe699", detektor: null },
            { id: 10, nazev: "Pr√°zdn√° slova", barva: "#b3d9ff", detektor: detekujPrazdnaSlova },
            { id: 11, nazev: "Ciz√≠ tƒõleso", barva: "#ffcc99", detektor: detekujCiziTeleso },
            { id: 12, nazev: "Ticho / mezera", barva: "#e0e0e0", detektor: detekujTicho }
        ];

        const PRAZDNA_SLOVA = ['jakoby', 'prostƒõ', 'vlastnƒõ', 'no', '≈æe jo', 'tak≈æe', 'prostƒõ', 'jaksi', 'v podstatƒõ'];
        const CIZI_TELESO_MIN_DELKA = 4; // minim√°ln√≠ d√©lka slova, aby bylo podez≈ôel√©

        function analyze() {
            const text = document.getElementById('inputText').value;
            if (!text.trim()) return;

            // Rozdƒõlen√≠ na vƒõty (jednoduch√©)
            const vety = text.split(/(?<=[.!?])\s+/).filter(v => v.trim());

            // Pro ka≈ædou vƒõtu zjist√≠me, kter√© poruchy se v n√≠ vyskytuj√≠
            const vysledkyVet = vety.map((veta, index) => {
                const poruchy = [];
                PORUCHY.forEach(p => {
                    if (p.detektor && p.detektor(veta, vety, index)) {
                        poruchy.push(p.id);
                    }
                });
                return { text: veta, poruchy };
            });

            // Sestaven√≠ barevn√©ho HTML
            let html = '';
            vysledkyVet.forEach((v, i) => {
                if (v.poruchy.length === 0) {
                    html += v.text + ' ';
                } else {
                    // Podle prvn√≠ho n√°lezu (pro jednoduchost)
                    const p = PORUCHY.find(p => p.id === v.poruchy[0]);
                    html += `<mark style="background-color: ${p.barva};">${v.text}</mark> `;
                }
            });
            document.getElementById('result').innerHTML = html;

            // Legenda
            const legendaHtml = PORUCHY.map(p => 
                `<div class="legend-item"><span class="color-box" style="background:${p.barva};"></span> ${p.nazev}</div>`
            ).join('');
            document.getElementById('legend').innerHTML = '<strong>Legenda:</strong> ' + legendaHtml;

            // Statistiky
            const staty = {};
            vysledkyVet.forEach(v => {
                v.poruchy.forEach(id => {
                    staty[id] = (staty[id] || 0) + 1;
                });
            });

            let statsHtml = '<h3>üìä Nalezen√© poruchy</h3><ul>';
            PORUCHY.forEach(p => {
                if (staty[p.id]) {
                    statsHtml += `<li style="border-left-color: ${p.barva};"><strong>${p.nazev}:</strong> ${staty[p.id]}√ó</li>`;
                }
            });
            if (Object.keys(staty).length === 0) statsHtml += '<li>≈Ω√°dn√© poruchy nenalezeny.</li>';
            statsHtml += '</ul>';
            document.getElementById('stats').innerHTML = statsHtml;
        }

        // --- DETEKTORY (jen z√°kladn√≠, lze d√°le vylep≈°ovat) ---
        function detekujOpakovani(veta, vety, index) {
            if (index === 0) return false;
            const slova = veta.split(/\s+/);
            const slovaPredchozi = vety[index-1].split(/\s+/);
            // Hled√°me stejn√© slovo v p≈ôedchoz√≠ vƒõtƒõ (zjednodu≈°enƒõ)
            return slova.some(s => slovaPredchozi.includes(s) && s.length > 3);
        }

        function detekujPretrzeni(veta) {
            return veta.includes('‚Ä¶') || veta.includes('..') || veta.includes('prostƒõ') || veta.includes('no nic');
        }

        function detekujPrazdnaSlova(veta) {
            const slova = veta.toLowerCase().split(/\s+/);
            return PRAZDNA_SLOVA.some(ps => slova.includes(ps));
        }

        function detekujCiziTeleso(veta, vety, index) {
            // Zjednodu≈°enƒõ: pokud vƒõta obsahuje slovo, kter√© se v cel√©m textu vyskytuje jen jednou
            const vsechnaSlova = vety.flatMap(v => v.split(/\s+/).map(s => s.toLowerCase().replace(/[.,!?]/g, '')));
            const slovaVety = veta.split(/\s+/).map(s => s.toLowerCase().replace(/[.,!?]/g, ''));
            return slovaVety.some(slovo => {
                if (slovo.length < CIZI_TELESO_MIN_DELKA) return false;
                const pocet = vsechnaSlova.filter(s => s === slovo).length;
                return pocet === 1;
            });
        }

        function detekujTicho(veta) {
            return veta.trim() === '' || veta.includes('(mlƒç√≠)') || veta === '‚Ä¶';
        }
    </script>
</body>
</html>
